server {
        listen 5000 ssl;

        ssl_certificate     --HOME--/.m2ag-labs/ssl/server.crt;
        ssl_certificate_key --HOME--/.m2ag-labs/ssl/server.key;
        ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers         HIGH:!aNULL:!MD5;

        server_name --HOSTNAME--.local;

        access_log            /var/log/nginx/m2ag-proxy.access.log;

        
        add_header 'Access-Control-Allow-Methods' 'GET,OPTIONS,PUT,DELETE' always;
        add_header 'Access-Control-Allow-Credentials' 'true' always;
        add_header 'Access-Control-Allow-Origin' '$http_origin' always;
        add_header 'Access-Control-Allow-Headers' 'Authorization,DNT,User-Agent,Keep-Alive,Content-Type,accept,origin,X-Requested-With' always;
        add_header 'Access-Control-Expose-Headers' 'Authorization,DNT,User-Agent,Keep-Alive,Content-Type,accept,origin,X-Requested-With';

        if ($request_method = OPTIONS ) {

             return 200;
        }

    location /video {
	     proxy_set_header        Host $host;
         proxy_set_header        X-Real-IP $remote_addr;
         proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
         proxy_set_header        X-Forwarded-Proto $scheme;

         proxy_pass          http://127.0.0.1:8091;
	}


	location / {
           proxy_set_header        Host $host;
           proxy_set_header        X-Real-IP $remote_addr;
           proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
           proxy_set_header        X-Forwarded-Proto $scheme;

           proxy_pass          http://127.0.0.1:5010;

           # Make options requests work #
           limit_except OPTIONS {
              auth_basic "--HOSTNAME--";
              auth_basic_user_file /home/pi/.m2ag-labs/.htpasswd;
          }
        }

}
